## 实验1：**SMP/E** 准备工作

**实验目的**：创建一个 Global CSI，Target CSI 和 Distribution CSI

**实验结果**：实验后，学生应该掌握

- 创建CSI
- 初始化 CSI
- 创建 SMP/E 数据集
- 定义 Global Zone, Target Zone, Distribution Zone

**实验指导**：使用 IDCAMS 实用程序中的 DEFINE CLUSTER 命令创建一个 CSI 数据集。

**实验步骤：**

### 步骤**1** 

提􏰀交以下JCL作业，创建一个新的CSI数据集 

```
//*以下作业用来完成 SMP/E 的准备工作。

//*作业流程概要:

//*1 创建一个 KSDS 数据集，作为 CSI

//*2 初始化 CSI

//*3 创建多个 SMP/E 管理的数据集，给 DDDEF 动态创建数据集做准备

//*4 分别定义全局区，目标区，分配区

//*********************************************************************
//*定义了一个名为 yourId.TDMF.SMP.CSI 的 KSDS 数据集，作为 CSI

//JOB1211 JOB 18xxxx,YOURNAME, NOTIFY=&SYSUID,
//         CLASS=A,MSGCLASS=A,MSGLEVEL=(1,1)
//DEFCSI EXEC PGM=IDCAMS,REGION=0M
//SYSPRINT DD SYSOUT=*
//SYSIN DD *
  DEFINE CLUSTER -
           (NAME(ST015.TDMF.SMP.CSI) -
           RECORDSIZE(24 143) -
           KEYS(24 0) -
           FREESPACE(10,5) -
           SHR(2) -
           VOLUMES(BYWK00) -
           UNIQUE -
           IMBED) -
         DATA (NAME(ST015.TDMF.SMP.CSI.DATA) -
              CONTROLINTERVALSIZE(4096) -
              CYLINDERS(1 1)) -
         INDEX (NAME(ST015.TDMF.SMP.CSI.INDEX) -
              TRACKS(10 10))
```

### 步骤2

提交以下 JCL 作业，格式化一个新的 CSI 数据集 

```
//* 将 CSI 准备好

//* 将 SYS1.MACLIB 中的 GIMZPOOL 成员复制到刚刚建好的 CSI 中，对 CSI 进行初始化。

//JOB1212 JOB 18xxxxx,YOURNAME, NOTIFY=&SYSUID,
//         CLASS=A,MSGCLASS=A,MSGLEVEL=(1,1)
//INITCSI EXEC PGM=IDCAMS,REGION=0M
//SMPCSI DD DSN=ST0XX.TDMF.SMP.CSI,
//        DISP=OLD
//ZPOOL DD DSN=SYS1.MACLIB(GIMZPOOL),DISP=SHR
//SYSPRINT DD SYSOUT=*
//SYSIN DD *
  REPRO INFILE(ZPOOL) OUTFILE(SMPCSI)
/*
```

### 步骤3

步骤 3	定义一个过程，创建 SMP/E 数据集，这 7 个数据集分别如下，同时初始化 global zone，定义 DDDEF，关联数据集（包括这 **7个**新建的数据集）。

<img src="/img/smp/lab1/2.png" alt="截屏2020-06-15 17.55.21" style="zoom:50%;" />

示范 JCL 作业如下。

```
//JOB1213 JOB 18xxxxx,YOURNAME, NOTIFY=&SYSUID,
//         CLASS=A,MSGCLASS=A,MSGLEVEL=(1,1)
//CRTDS PROC SMPPRFX='ST0XX.TDMF.SMP',BLKSZ=27920
//SMPE EXEC PGM=GIMSMP,REGION=0M
//SMPCSI DD DSN=ST0XX.TDMF.SMP.CSI,DISP=OLD
//SMPLIST DD SYSOUT=*
//SYSPRINT DD SYSOUT=*
//SMPLOG DD DSN=&SMPPRFX..SMPLOG,
//          DISP=(NEW,CATLG,DELETE),
//          DSORG=PS,
//          RECFM=VB,
//          LRECL=3200,
//          BLKSIZE=&BLKSZ,
//          UNIT=SYSDA,
//          SPACE=(3200,(35,35))
//SMPLOGA DD DSN=&SMPPRFX..SMPLOGA,
//          DISP=(NEW,CATLG,DELETE),
//          DSORG=PS,
//          RECFM=VB,
//          LRECL=3200,
//          BLKSIZE=&BLKSZ,
//          UNIT=SYSDA,
//          SPACE=(3200,(35,35))
//SMPLTS DD DSN=&SMPPRFX..SMPLTS,
//        DISP=(NEW,CATLG,DELETE),
//        DSNTYPE=LIBRARY,
//        RECFM=U,
//        LRECL=0,
//        BLKSIZE=32760,
//        UNIT=SYSDA,
//        SPACE=(6144,(1200,300,150))
//SMPMTS DD DSN=&SMPPRFX..SMPMTS,
//        DISP=(NEW,CATLG,DELETE),
//        DSORG=PO,
//        RECFM=FB,
//        LRECL=80,
//        BLKSIZE=&BLKSZ,
//        UNIT=SYSDA,
//        SPACE=(6160,(35,20,10))
//SMPPTS DD DSN=&SMPPRFX..SMPPTS,
//        DISP=(NEW,CATLG,DELETE),
//        DSORG=PO,
//        RECFM=FB,
//        LRECL=80,
//        BLKSIZE=&BLKSZ,
//        UNIT=SYSDA,
//        SPACE=(6160,(350,350,80))
//SMPSCDS DD DSN=&SMPPRFX..SMPSCDS,
//        DISP=(NEW,CATLG,DELETE),
//        DSORG=PO,
//        RECFM=FB,
//        LRECL=80,
//        BLKSIZE=&BLKSZ,
//        UNIT=SYSDA,
//        SPACE=(6160,(70,35,80))
//SMPSTS DD DSN=&SMPPRFX..SMPSTS,
//        DISP=(NEW,CATLG,DELETE),
//        DSORG=PO,
//        RECFM=FB,
//        LRECL=80,
//        BLKSIZE=&BLKSZ,
//        UNIT=SYSDA,
//        SPACE=(6160,(35,35,80))
//SMPOUT DD SYSOUT=*
//SMPRPT DD SYSOUT=*
//SMPSNAP DD SYSOUT=*
//SMPWRK1 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK2 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK3 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK4 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK5 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK6 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SYSUT1 DD UNIT=SYSDA,SPACE=(CYL,(2,1))
//SYSUT2 DD UNIT=SYSDA,SPACE=(CYL,(2,1))
//SYSUT3 DD UNIT=SYSDA,SPACE=(CYL,(2,1))
//SYSUT4 DD UNIT=SYSDA,SPACE=(CYL,(2,1))
// PEND
//STEP1 EXEC CRTDS
//SMPCNTL DD *
  SET BDY(GLOBAL) .
  UCLIN.
    ADD GLOBALZONE
        OPTIONS(TDMOPT)
        SREL(Z038)
        ZONEINDEX(
       (TZONE,ST0XX.TDMF.SMP.CSI,TARGET),
       (DZONE,ST0XX.TDMF.SMP.CSI,DLIB)).
       ADD OPTIONS(TDMOPT)
           ASM(ASMUTIL)
           LKED(LINKEDIT)
           DSPREFIX(ST0XX.TDMF.SMP)
           DSSPACE(1200,1200,1400)
           NOPURGE.
       ADD UTILITY(ASMUTIL)
           NAME(ASMA90)
           PARM(DECK,NOOBJECT,USING(WARN(2)))
           RC(4).
       ADD UTILITY(LINKEDIT)
           NAME(HEWLH096)
           RC(4)
           PRINT(SYSPRINT)
           PARM(SIZE=(1526K,100K),NCAL,LET,LIST,XREF).
       ADD DDDEF(SMPOUT) SYSOUT(*).
       ADD DDDEF(SMPRPT) SYSOUT(*).
       ADD DDDEF(SMPLIST) SYSOUT(*).
       ADD DDDEF(SYSPRINT) SYSOUT(*).
       ADD DDDEF(SMPSNAP) SYSOUT(*).
       ADD DDDEF(SMPTLIB) UNIT(SYSDA).
       ADD DDDEF(SYSUT1) CYL SPACE(2,1) UNIT(SYSDA).
       ADD DDDEF(SYSUT2) CYL SPACE(2,1) UNIT(SYSDA).
       ADD DDDEF(SYSUT3) CYL SPACE(2,1) UNIT(SYSDA).
       ADD DDDEF(SYSUT4) CYL SPACE(2,1) UNIT(SYSDA).
       ADD DDDEF(SMPTLOAD) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
       ADD DDDEF(SMPLOG) DA(ST0XX.TDMF.SMP.SMPLOG) MOD.
       ADD DDDEF(SMPLOGA) DA(ST0XX.TDMF.SMP.SMPLOGA) MOD.
       ADD DDDEF(SMPLTS) DA(ST0XX.TDMF.SMP.SMPLTS) SHR.
       ADD DDDEF(SMPMTS) DA(ST0XX.TDMF.SMP.SMPMTS) SHR.
       ADD DDDEF(SMPPTS) DA(ST0XX.TDMF.SMP.SMPPTS) SHR.
       ADD DDDEF(SMPSCDS) DA(ST0XX.TDMF.SMP.SMPSCDS) SHR.
       ADD DDDEF(SMPSTS) DA(ST0XX.TDMF.SMP.SMPSTS) SHR.
     ENDUCL .

```

执行上述 JCL 作业，定义 Global Zone，为其定义 Option，Utility，DDDEF。

**补充（关于Utility）：**

If you do not define UTILITY entries and OPTIONS entries to specify which utility programs to use, SMP/E uses default utility programs, as well as its own default values, for return codes, print values, and the parameters to be passed. Table 4 lists the default values for the various types of utility programs.

<img src="/img/smp/lab1/1.png" alt="1" style="zoom:50%;" />

### 步骤4

修改上述 JCL 作业，定义 Target Zone，为其定义默认 Option 及 DDDEF。 

```
//JOB1214 JOB 18xxxxx,YOURNAME, NOTIFY=&SYSUID,
//         CLASS=A,MSGCLASS=A,MSGLEVEL=(1,1)
//CRTDS PROC SMPPRFX='ST0XX.TDMF.SMP',BLKSZ=27920
//SMPE EXEC PGM=GIMSMP,REGION=0M
//SMPCSI DD DSN=ST0XX.TDMF.SMP.CSI,DISP=OLD
//SMPLIST DD SYSOUT=*
//SYSPRINT DD SYSOUT=*
//SMPLOG DD DSN=&SMPPRFX..SMPLOG,
//          DISP=(OLD,CATLG,DELETE),
//          DSORG=PS,
//          RECFM=VB,
//          LRECL=3200,
//          BLKSIZE=&BLKSZ,
//          UNIT=SYSDA,
//          SPACE=(3200,(35,35))
//SMPLOGA DD DSN=&SMPPRFX..SMPLOGA,
//          DISP=(OLD,CATLG,DELETE),
//          DSORG=PS,
//          RECFM=VB,
//          LRECL=3200,
//          BLKSIZE=&BLKSZ,
//          UNIT=SYSDA,
//          SPACE=(3200,(35,35))
//SMPLTS DD DSN=&SMPPRFX..SMPLTS,
//        DISP=(OLD,CATLG,DELETE),
//        DSNTYPE=LIBRARY,
//        RECFM=U,
//        LRECL=0,
//        BLKSIZE=32760,
//        UNIT=SYSDA,
//        SPACE=(6144,(1200,300,150))
//SMPMTS DD DSN=&SMPPRFX..SMPMTS,
//        DISP=(OLD,CATLG,DELETE),
//        DSORG=PO,
//        RECFM=FB,
//        LRECL=80,
//        BLKSIZE=&BLKSZ,
//        UNIT=SYSDA,
//        SPACE=(6160,(35,20,10))
//SMPPTS DD DSN=&SMPPRFX..SMPPTS,
//        DISP=(OLD,CATLG,DELETE),
//        DSORG=PO,
//        RECFM=FB,
//        LRECL=80,
//        BLKSIZE=&BLKSZ,
//        UNIT=SYSDA,
//        SPACE=(6160,(350,350,80))
//SMPSCDS DD DSN=&SMPPRFX..SMPSCDS,
//        DISP=(OLD,CATLG,DELETE),
//        DSORG=PO,
//        RECFM=FB,
//        LRECL=80,
//        BLKSIZE=&BLKSZ,
//        UNIT=SYSDA,
//        SPACE=(6160,(70,35,80))
//SMPSTS DD DSN=&SMPPRFX..SMPSTS,
//        DISP=(OLD,CATLG,DELETE),
//        DSORG=PO,
//        RECFM=FB,
//        LRECL=80,
//        BLKSIZE=&BLKSZ,
//        UNIT=SYSDA,
//        SPACE=(6160,(35,35,80))
//SMPOUT DD SYSOUT=*
//SMPRPT DD SYSOUT=*
//SMPSNAP DD SYSOUT=*
//SMPWRK1 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK2 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK3 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK4 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK5 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK6 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SYSUT1 DD UNIT=SYSDA,SPACE=(CYL,(2,1))
//SYSUT2 DD UNIT=SYSDA,SPACE=(CYL,(2,1))
//SYSUT3 DD UNIT=SYSDA,SPACE=(CYL,(2,1))
//SYSUT4 DD UNIT=SYSDA,SPACE=(CYL,(2,1))
// PEND
//STEP1 EXEC CRTDS
//SMPCNTL DD *
  SET BDY(TZONE) .
  UCLIN.
    ADD TARGETZONE(TZONE)
        RELATED(DZONE)
        OPTIONS(TDMOPT)
        SREL(Z038)
        .
       ADD DDDEF(SMPOUT) SYSOUT(*).
       ADD DDDEF(SMPRPT) SYSOUT(*).
       ADD DDDEF(SMPLIST) SYSOUT(*).
       ADD DDDEF(SYSPRINT) SYSOUT(*).
       ADD DDDEF(SMPSNAP) SYSOUT(*).
       ADD DDDEF(SYSUT1) CYL SPACE(2,1) UNIT(SYSDA).
       ADD DDDEF(SYSUT2) CYL SPACE(2,1) UNIT(SYSDA).
       ADD DDDEF(SYSUT3) CYL SPACE(2,1) UNIT(SYSDA).
       ADD DDDEF(SYSUT4) CYL SPACE(2,1) UNIT(SYSDA).
       ADD DDDEF(SMPTLOAD) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
       ADD DDDEF(SMPLOG) DA(ST0XX.TDMF.SMP.SMPLOG) MOD.
       ADD DDDEF(SMPLOGA) DA(ST0XX.TDMF.SMP.SMPLOGA) MOD.
       ADD DDDEF(SMPLTS) DA(ST0XX.TDMF.SMP.SMPLTS) SHR.
       ADD DDDEF(SMPMTS) DA(ST0XX.TDMF.SMP.SMPMTS) SHR.
       ADD DDDEF(SMPPTS) DA(ST0XX.TDMF.SMP.SMPPTS) SHR.
       ADD DDDEF(SMPSCDS) DA(ST0XX.TDMF.SMP.SMPSCDS) SHR.
       ADD DDDEF(SMPSTS) DA(ST0XX.TDMF.SMP.SMPSTS) SHR.
       ADD DDDEF(SYSLIB) CONCAT(SMPMTS).
       ADD DDDEF(SMPWRK1) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
       ADD DDDEF(SMPWRK2) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
       ADD DDDEF(SMPWRK3) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
       ADD DDDEF(SMPWRK4) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
       ADD DDDEF(SMPWRK5) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
       ADD DDDEF(SMPWRK6) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
     ENDUCL .
```

### 步骤5

修改上述JCL作业，定义DistributionZone，为其定义默认Option及DDDEF。

```
//JOB1215 JOB 18xxxxx,YOURNAME, NOTIFY=&SYSUID,
//         CLASS=A,MSGCLASS=A,MSGLEVEL=(1,1)
//CRTDS PROC SMPPRFX='ST0XX.TDMF.SMP',BLKSZ=15920
//SMPE EXEC PGM=GIMSMP,REGION=0M
//SMPCSI DD DSN=ST0XX.TDMF.SMP.CSI,DISP=OLD
//SMPLIST DD SYSOUT=*
//SYSPRINT DD SYSOUT=*
//SMPLOG DD DSN=&SMPPRFX..SMPLOG,
//          DISP=(OLD,CATLG,DELETE),
//          DSORG=PS,
//          RECFM=VB,
//          LRECL=3200,
//          BLKSIZE=&BLKSZ,
//          UNIT=SYSDA,
//          SPACE=(3200,(35,35))
//SMPLOGA DD DSN=&SMPPRFX..SMPLOGA,
//          DISP=(OLD,CATLG,DELETE),
//          DSORG=PS,
//          RECFM=VB,
//          LRECL=3200,
//          BLKSIZE=&BLKSZ,
//          UNIT=SYSDA,
//          SPACE=(3200,(35,35))
//SMPLTS DD DSN=&SMPPRFX..SMPLTS,
//        DISP=(OLD,CATLG,DELETE),
//        DSNTYPE=LIBRARY,
//        RECFM=U,
//        LRECL=0,
//        BLKSIZE=32760,
//        UNIT=SYSDA,
//        SPACE=(6144,(1200,300,150))
//SMPMTS DD DSN=&SMPPRFX..SMPMTS,
//        DISP=(OLD,CATLG,DELETE),
//        DSORG=PO,
//        RECFM=FB,
//        LRECL=80,
//        BLKSIZE=&BLKSZ,
//        UNIT=SYSDA,
//        SPACE=(6160,(35,20,10))
//SMPPTS DD DSN=&SMPPRFX..SMPPTS,
//        DISP=(OLD,CATLG,DELETE),
//        DSORG=PO,
//        RECFM=FB,
//        LRECL=80,
//        BLKSIZE=&BLKSZ,
//        UNIT=SYSDA,
//        SPACE=(6160,(350,350,80))
//SMPSCDS DD DSN=&SMPPRFX..SMPSCDS,
//        DISP=(OLD,CATLG,DELETE),
//        DSORG=PO,
//        RECFM=FB,
//        LRECL=80,
//        BLKSIZE=&BLKSZ,
//        UNIT=SYSDA,
//        SPACE=(6160,(70,35,80))
//SMPSTS DD DSN=&SMPPRFX..SMPSTS,
//        DISP=(OLD,CATLG,DELETE),
//        DSORG=PO,
//        RECFM=FB,
//        LRECL=80,
//        BLKSIZE=&BLKSZ,
//        UNIT=SYSDA,
//        SPACE=(6160,(35,35,80))
//SMPOUT DD SYSOUT=*
//SMPRPT DD SYSOUT=*
//SMPSNAP DD SYSOUT=*
//SMPWRK1 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK2 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK3 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK4 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK5 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SMPWRK6 DD UNIT=SYSDA,SPACE=(CYL,(2,1,10)),DCB=BLKSIZE=6160
//SYSUT1 DD UNIT=SYSDA,SPACE=(CYL,(2,1))
//SYSUT2 DD UNIT=SYSDA,SPACE=(CYL,(2,1))
//SYSUT3 DD UNIT=SYSDA,SPACE=(CYL,(2,1))
//SYSUT4 DD UNIT=SYSDA,SPACE=(CYL,(2,1))
// PEND
//STEP1 EXEC CRTDS
//SMPCNTL DD *
  SET BDY(DZONE) .
  UCLIN.
    ADD DLIBZONE(DZONE)
        RELATED(TZONE)
        OPTIONS(TDMOPT)
        SREL(Z038)
       .
       ADD DDDEF(SMPOUT) SYSOUT(*).
       ADD DDDEF(SMPRPT) SYSOUT(*).
       ADD DDDEF(SMPLIST) SYSOUT(*).
       ADD DDDEF(SYSPRINT) SYSOUT(*).
       ADD DDDEF(SMPSNAP) SYSOUT(*).
       ADD DDDEF(SYSUT1) CYL SPACE(2,1) UNIT(SYSDA).
       ADD DDDEF(SYSUT2) CYL SPACE(2,1) UNIT(SYSDA).
       ADD DDDEF(SYSUT3) CYL SPACE(2,1) UNIT(SYSDA).
       ADD DDDEF(SYSUT4) CYL SPACE(2,1) UNIT(SYSDA).
       ADD DDDEF(SMPTLOAD) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
       ADD DDDEF(SMPLOG) DA(ST0XX.TDMF.SMP.SMPLOG) MOD.
       ADD DDDEF(SMPLOGA) DA(ST0XX.TDMF.SMP.SMPLOGA) MOD.
       ADD DDDEF(SMPLTS) DA(ST0XX.TDMF.SMP.SMPLTS) SHR.
       ADD DDDEF(SMPMTS) DA(ST0XX.TDMF.SMP.SMPMTS) SHR.
       ADD DDDEF(SMPPTS) DA(ST0XX.TDMF.SMP.SMPPTS) SHR.
       ADD DDDEF(SMPSCDS) DA(ST0XX.TDMF.SMP.SMPSCDS) SHR.
       ADD DDDEF(SMPSTS) DA(ST0XX.TDMF.SMP.SMPSTS) SHR.
       ADD DDDEF(SYSLIB) CONCAT(SMPMTS).
       ADD DDDEF(SMPWRK1) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
       ADD DDDEF(SMPWRK2) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
       ADD DDDEF(SMPWRK3) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
       ADD DDDEF(SMPWRK4) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
       ADD DDDEF(SMPWRK5) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
       ADD DDDEF(SMPWRK6) CYL SPACE(2,1) DIR(10) UNIT(SYSDA).
     ENDUCL .
```

### 步骤六

􏰀交JCL作业，查看之前几个步骤定义的ZONE。

提􏰀示：**SMP/E** 命令

```
SET BDY(GLOBAL).
LIST ALLZONES . /* 列出区域信息 */
```

